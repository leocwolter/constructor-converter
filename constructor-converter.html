<html>
<!--
 Copyright (C) 2006 Joe Walnes.
 Copyright (C) 2006, 2007, 2011 XStream committers.
 All rights reserved.
 
 The software in this package is published under the terms of the BSD
 style license a copy of which has been included with this distribution in
 the LICENSE.txt file.
 
 Created on 04. January 2013 by Chico Sokol & Leonardo Wolter
 -->
  <head>
	<title>Constructor Converter Tutorial</title>
  </head>
  <body>

<!-- ...................................................... -->
<h2 id="Motivation">Motivation</h2>
<p>Sometimes you need do gather only a few informations from the xml file, which is very extense, and ignore the ones that you do not need</p>
<p>The xStream have a ConstructorConverter class that makes possible to inform the nodes that you want to gather and inject them into your class's CONSTRUCTOR</p>
<p>This tutorial will show you how to use that feature to do it easily using a very succint and fluent syntax.</p>
<p>There are three ways for doing this operation, which will be explained bellow</p>
<!-- ...................................................... -->
<h2 id="ProgramaticWay">The Programatic Way</h2>
<p>The first way to be explained will be the programatic way:</p>
<p>Suppose that you have the following xml:</p>
<div class="Source Java"><pre>
	&lt;order&gt;
		&lt;products&gt;
			&lt;product&gt;
				&lt;name&gt;first product&lt;/name&gt;
			&lt;/product&gt;
			&lt;product&gt;
				&lt;name&gt;second product&lt;/name&gt;
			&lt;/product&gt;
		&lt;/products&gt;
		&lt;buyer&gt;buyer name&lt;/buyer&gt;
		&lt;useless&gt;something&lt;/useless&gt;
	&lt;/order&gt;
</pre></div>
<p>And you need to map that xml to the following classes ignoring the <code>useless</code> xml node</p>
<div class="Source Java"><pre>
	 private static class Order {

		private final List&lt;Product&gt; products;
		private final String buyer;

		protected Order(List&lt;Product&gt; products, String buyer) {
			this.products = products;
			this.buyer = buyer;
		}
	}

	public static class Product {
		private final String name;
\
		protected Product(String name) {
			this.name = name;
		}
	}
</pre></div>

<p>Now, to make a constructor converter we need to use the class ConstructorConverterBuilder informing the constructor that it'll use and the aliases to each xml nodes wanted <strong>IN THE SAME ORDER THAT YOUR CONSTRUCTOR'S PARAMETERS</strong></p>
<p>The method build() will return a new Converter:</p>
<div class="Source Java"><pre>

        Converter orderConverter = new ConstructorConverterBuilder(Order.class)
            .withConstructor(String.class, List.class, String.class)
            .withAliases("id", "products", "buyer")
            .build();
            
        Converter productConverter = new ConstructorConverterBuilder(Product.class)
            .withConstructor(String.class)
            .withAliases("name")
            .build();

</pre></div>
<p>Note: while using this way, all the three method calls cited above are necessary</p>
<p>All that you need to do now is to register these converters and call the xStream.fromXML(xml) method normally:</p>
<div class="Source Java"><pre>
	   	xStream.registerConverter(orderConverter);
        xStream.registerConverter(productConverter);
        Order order = (Order) xStream.fromXML(xml);
</pre></div>
<p>The result will be an instance of Order with all the xml information that were necessary</p>
<!-- ...................................................... -->
<h2 id="Summary">Using annotations</h2>
<p>
It is possible to use the converter by annotating the constructor you want to XStream use when unmarshal the xml data. To do this, simply annotate
the desired constructor with @UseThis annotation.
</p>
<p>
Consider the following xml file:
</p>
<div class="Source Java"><pre>
&lt;user&gt;
    &lt;id&gt;1&lt;/id&gt;
    &lt;user-name&gt;Francisco Sokol&lt;/user-name&gt;
    &lt;user-age&gt;51&lt;/user-age&gt;
&lt;/user&gt;
</pre></div>
<p>
And you need to map that xml to the following class:
</p>
<div class="Source Java"><pre>
public class AnnotatedUser {
    private final String name;
    private final int age;
    
    @UseThis({"user-name", "user-age"})
    protected AnnotatedUser(String name, int age) {
        this.name = name;
        this.age = age;
    }
}
</pre></div>
<p>
	By annotating the constructor with <em>@UseThis({"user-name", "user-age"})</em>, the converter will use that constructor and map the cell named <em>user-name</em> 
from the xml to the <em>name</em> parameter of the constructor and <em>user-age</em> to <em>age</em>.
</p>
<p>
	The order of the annotation's parameters must be the same a the constructor's parameters. If you change the order of the annotation's parameters to @UseThis({"user-age","user-name"}) it won't work as expected.
</p>
<p>
	And to build the converter simply do:
</p>

<div class="Source Java"><pre>
xstream.alias("user", AnnotatedUser.class);
ConstructorConverter converter = new ConstructorConverterBuilder(AnnotatedUser.class).build();
xstream.registerConverter(converter);
</pre></div>


<!-- ...................................................... -->
<h2 id="Summary">Using Paramaner to infer name constructor parameters</h2>
<p>
If you have <a href="http://paranamer.codehaus.org/">Paranamer</a> added in the classpath of your project, the ConstructorConverter may use it to discover the parameter names of the annotated constructor and use those names to map them to the xml cells.
</p>
<p>
Consider the following xml file, similar to the previous example:
</p>
<div class="Source Java"><pre>
&lt;user&gt;
    &lt;id&gt;1&lt;/id&gt;
    &lt;name&gt;Francisco Sokol&lt;/user-name&gt;
    &lt;age&gt;51&lt;/age&gt;
&lt;/user&gt;
</pre></div>
<p>
<p>
By using Paranamer, you can omit the parameter of the @UseThis annotation and the converter will use parameters names to find out which cells from the xml to use.
So you only need to annotate the constructor, like this: 
</p>
<div class="Source Java"><pre>
public class ParanamerUser {
    private final String name;
    private final int age;
    
    @UseThis
    protected ParanamerUser(String name, int age) {
        this.name = name;
        this.age = age;
    }
}
</pre></div>
<p>
Now, with Paranamer jar in the claspath, you can build the converter:
</p>
<div class="Source Java"><pre>
xstream.alias("user", ParanamerUser.class);
ConstructorConverter converter = new ConstructorConverterBuilder(ParanamerUser.class).withParanamer().build();
xstream.registerConverter(converter);
</pre></div>
  </body>
</html>
