<html>
<!--
 Copyright (C) 2006 Joe Walnes.
 Copyright (C) 2006, 2007, 2011 XStream committers.
 All rights reserved.
 
 The software in this package is published under the terms of the BSD
 style license a copy of which has been included with this distribution in
 the LICENSE.txt file.
 
 Created on 04. January 2013 by Chico Sokol & Leonardo Wolter
 -->
  <head>
	<title>Constructor Converter Tutorial</title>
  </head>
  <body>

<!-- ...................................................... -->
<h2 id="Motivation">Motivation</h2>

<p>Sometimes you need only a few pieces of information fom a lengthy XML file.</p>
<p>Using ConstructorConverter, you inform the nodes that you want to use and inject them into your class's CONSTRUCTOR.</p>
<p>This tutorial will show you how to use that feature to do it easily with a very succint and fluent syntax.</p>
<p>There are three ways for doing this operation, which will be explained bellow.</p>

<!-- ...................................................... -->
<h2 id="ProgramaticWay">The Programatic Way</h2>
<p>Suppose that you have the following xml:</p>
<div class="Source Java"><pre>
	&lt;order&gt;
		&lt;products&gt;
			&lt;product&gt;
				&lt;name&gt;first product&lt;/name&gt;
			&lt;/product&gt;
			&lt;product&gt;
				&lt;name&gt;second product&lt;/name&gt;
			&lt;/product&gt;
		&lt;/products&gt;
		&lt;buyer&gt;buyer name&lt;/buyer&gt;
		&lt;useless&gt;something&lt;/useless&gt;
	&lt;/order&gt;
</pre></div>
<p>And you need to map that xml to the following classes ignoring the <code>useless</code> xml node:</p>
<div class="Source Java"><pre>
	 private static class Order {

		private final List&lt;Product&gt; products;
		private final String buyer;

		protected Order(List&lt;Product&gt; products, String buyer) {
			this.products = products;
			this.buyer = buyer;
		}
	}

	public static class Product {
		private final String name;

		protected Product(String name) {
			this.name = name;
		}
	}
</pre></div>

<p>Now, to build a constructor converter we need to use the class ConstructorConverterBuilder and inform which constructor it will use and the aliases to each xml nodes wanted <strong>in the same order as the parameters of your constructor</strong>.</p>
<p>The method <code>build()</code> will return a new Converter:</p>
<div class="Source Java"><pre>

        ConstructorConverter orderConverter = new ConstructorConverterBuilder(Order.class)
            .withConstructor(String.class, List.class, String.class)
            .withAliases("id", "products", "buyer")
            .build();
            
        ConstructorConverter productConverter = new ConstructorConverterBuilder(Product.class)
            .withConstructor(String.class)
            .withAliases("name")
            .build();

</pre></div>
<p>Note: while using this way, all the three method calls cited above are necessary</p>
<p>All that you need to do now is to register these converters and call the xStream.fromXML(xml) method normally:</p>
<div class="Source Java"><pre>
	   	xStream.registerConverter(orderConverter);
        xStream.registerConverter(productConverter);
        Order order = (Order) xStream.fromXML(xml);
</pre></div>
<p>The result will be an instance of Order with all the xml information that were necessary</p>
<!-- ...................................................... -->
<h2 id="AnnotationsWay">Using annotations</h2>
<p>
It is possible to use the converter by annotating the constructor you want to XStream use when unmarshal the xml data. To do this, simply annotate the desired constructor with @UseThis annotation.
</p>
<p>
Consider the following xml file:
</p>
<div class="Source Java"><pre>
&lt;user&gt;
    &lt;id&gt;1&lt;/id&gt;
    &lt;user-name&gt;Francisco Sokol&lt;/user-name&gt;
    &lt;user-age&gt;51&lt;/user-age&gt;
&lt;/user&gt;
</pre></div>
<p>
And you need to map that xml to the following class:
</p>
<div class="Source Java"><pre>
public class AnnotatedUser {
    private final String name;
    private final int age;
    
    @UseThis({"user-name", "user-age"})
    protected AnnotatedUser(String name, int age) {
        this.name = name;
        this.age = age;
    }
}
</pre></div>
<p>
	By annotating the constructor with <em>@UseThis({"user-name", "user-age"})</em>, the converter will use that constructor and map the cell named <em>user-name</em> 
from the xml to the <em>name</em> parameter of the constructor and <em>user-age</em> to <em>age</em>.
</p>
<p>
	The order of the annotation's parameters must be the same a the constructor's parameters. If you change the order of the annotation's parameters to @UseThis({"user-age","user-name"}) it won't work as expected.
</p>
<p>
	And to build the converter simply do:
</p>
0
<div class="Source Java"><pre>
xstream.alias("user", AnnotatedUser.class);
ConstructorConverter converter = new ConstructorConverterBuilder(AnnotatedUser.class).build();
xstream.registerConverter(converter);
</pre></div>
<!-- ...................................................... -->
<h2 id="ParanamerWay">Using Paramaner to infer name constructor parameters</h2>
<p>
If you have <a href="http://paranamer.codehaus.org/">Paranamer</a> added in the classpath of your project, the ConstructorConverter may use it to discover the parameter names of the annotated constructor and use those names to map them to the xml cells.
</p>
<p>
Consider the following xml file, similar to the previous example:
</p>
<div class="Source Java"><pre>
&lt;user&gt;
    &lt;id&gt;1&lt;/id&gt;
    &lt;name&gt;Francisco Sokol&lt;/name&gt;
    &lt;age&gt;51&lt;/age&gt;
&lt;/user&gt;
</pre></div>
<p>
By using Paranamer, you can omit the parameter of the @UseThis annotation and the converter will use parameters names to find out which cells from the xml to use.
</p>
<p>
So you only need to annotate the constructor, like this: 
</p>
<div class="Source Java"><pre>
public class ParanamerUser {
    private final String name;
    private final int age;
    
    @UseThis
    protected ParanamerUser(String name, int age) {
        this.name = name;
        this.age = age;
    }
}
</pre></div>
<p>NOTE: While using paranamer, the name of the xml nodes <strong>must be</strong> the same as the name of the parameters </p>
<p>
Now, with Paranamer jar in the claspath, you can build the converter:
<div class="Source Java"><pre>
xstream.alias("user", ParanamerUser.class);
ConstructorConverter converter = new ConstructorConverterBuilder(ParanamerUser.class).withParanamer().build();
xstream.registerConverter(converter);
</pre></div>
</p>

<h2 class="MarshallOpperation">Marshall Operation</h2>
<p>
The ConstructorConverter does not support the marshall(toXML) opperation and will throw UnsupportedOperationException if the method is called.</p>
</p>
</body>

<style>
/*
 Copyright (C) 2005, 2006 Joe Walnes.
 Copyright (C) 2006, 2007 XStream committers.
 All rights reserved.
 
 The software in this package is published under the terms of the BSD
 style license a copy of which has been included with this distribution in
 the LICENSE.txt file.
 
 Created on 29. January 2005 by Joe Walnes
*/

/*---------------------------------------------------------------------------
 *  Two- and three-column layout
 */

#banner {
    top: 0px;
    left: 0px;
    right: 0px;
    height: 116px;
}

#left {
    position: absolute;
    z-index: 2;
    left: 8px;
    width: 184px;
    top: 125px;
    bottom: 8px;
    margin: 0px;
    padding: 0px;
}

#right {
    position: absolute;
    z-index: 1;
    right: 8px;
    width: 184px;
    top: 125px;
    bottom: 8px;
    margin: 0px;
    padding: 0px;
}

.Content3Column {
    position: absolute;
    top: 125px;
    bottom: 8px;
    left: 208px;
    right: 216px;
}

.Content2Column {
    position: absolute;
    top: 125px;
    bottom: 8px;
    left: 208px;
    right: 16px;
}

#center {
    z-index: 3;
    margin: 0px;
    border: none;
    padding-bottom: 8px;
}


/*---------------------------------------------------------------------------
 *  Default element styles
 */

body {
    padding: 0px;
    margin: 0px;
    border: 0px;

    font-family: helvetica, arial, sans-serif;
    font-size: 12px;

    background-color: white;
    color: black;
}

h1, h2, h3, h4, h5, h6 {
    margin: 0px;
    border: 0px;
    padding: 0px;
    font-weight: normal;
}

a:link { color: #0a0; }
a:active { color: red; }
a:hover { color: red; }
a:visited { color: black; }

iframe {
    width:100%;
    height: 800px;
    border: 0px;
}

img {
    border: 0px;
    padding: 0px;
    margin: 0px;
}

p {
    border: 0px;
    padding: 0px;
    margin: 0px;
    margin-bottom: 10px;
}

blockquote {
    margin-bottom: 10px;
}

td {
    font-size: 12px;
    padding: 2px;
}

th {
    font-size: 12px;
    font-weight: bold;
    white-space: nowrap;
    padding: 2px;
}

th.Row {
    text-align: left;
    vertical-align: top;
}

ul, ol {
    border: 0px;
    padding: 0px;
    margin-top: 0px;
    margin-bottom: 12px;
    margin-left: 20px;
}


/*---------------------------------------------------------------------------
 *  Page banner
 */

#banner {
    margin: 0px;
    border: 0px;
    border-bottom: 1px solid #afa;
    padding: 0px;
    background-color: #e0f0e0;
    color: #060;
    vertical-align: bottom;
}

#banner a { text-decoration: none; }
#banner a:visited { color: #0a0; }
#banner a:hover { color: red; }
#banner a:active { color: red; }

#logo {
    position: absolute;
    top: 5px;
    left: 8px;
}

#versions {
    position: absolute;
    width: auto;
    right: 0px;
    top: 0px;
    margin: 8px;
    font-weight: normal;
}

/*---------------------------------------------------------------------------
 *  Page content
 */

#content {
    margin: 0px;
    background-color: white;
    color: black;
    height: 100%;
}

#content h1 {
    width: 100%;
    font-size: 18px;
    background-color: #060;
    color: white;
    padding: 2px;
    padding-left: 6px;
    margin-top: 24px;
    margin-bottom: 12px;
}

#content .FirstChild {  /* IE doesn't understand first-child pseudoelement */
    margin-top: 0px;
}

#content a { text-decoration: underline; }
#content a:link { color: #060; }
#content a:visited { color: #060; }
#content a:active { color: red; }
#content a:hover { color: red; }

#content h2 {
    margin-top: 24px;
    border-top: 1px solid #060;
    margin-bottom: 16px;
    font-size: 15px;
    font-weight: bold;
    background-color: #e0f0e0;
    padding: 2px;
}

#content li {
    margin-bottom: 6px;
}

#content th {
    background-color: #afa;
}

#content td {
    background-color: #dfd;
}

.Source pre {
    padding: 4px;
    font-family: courier new, monospace;
    font-size: 11px;
    border: 1px solid #080;
    background-color: #cfc;
    color: black;
}

.Source:before {
    margin: 0px;
    padding: 0px;
    border: 0px;
    font-size: inherit;
    line-spacing: 100%;
}

.highlight {
    background-color: #e0f0e0;
    border: 1px dotted #060;
    padding: 5px;
}

/* The following are for images, but can also apply to div's containing images. */

#content .Float {
    float: right;
    margin-left: 8px;
    margin-right: 0px;
    margin-top: 8px;
    margin-bottom: 8px;
}

#content .Diagram {
    display: block;
    margin-left: auto;
    margin-right: auto;
    margin-top: 8px;
    margin-bottom: 8px;
}


#content .Inline {
    display: inline;
}

.RuleOfThumb {
    font-weight: bold;
}

#content h1[id]:hover:after, #content h2[id]:hover:after {
    content: " #" attr(id) " ";
    font-size: 90%;
    color: #aaa;
    text-decoration: none;
}

/*---------------------------------------------------------------------------
 *  Side panels
 */

.SidePanel {
    background-color: white;
    padding: 0px;
    font-size: 11px;
}

.SidePanel h1 {
    margin: 0px;
    border: 0px;
    padding: 4px;

    color: #060;

    font-size: 12px;
    font-weight: bold;
}


.SidePanel a { text-decoration: none; }
.SidePanel a:link { color: #060; }
.SidePanel a:visited { color: #060; }
.SidePanel a:active { color: red; }
.SidePanel a:hover { color: red; }

/*---------------------------------------------------------------------------
 *  Menus
 */

.MenuGroup {
    border-left: 1px solid #afa;
    border-top: 1px solid #afa;
    border-bottom: 1px solid white; /* IE work-around */

    margin-bottom: 8px;
    background-color: white;
    color: #060;
}

.MenuGroup ul {
    margin: 0px;
    padding-left: 4px;
    list-style-type: none;
}

.MenuGroup li {
    padding: 2px;
}

.MenuGroup .currentLink {
/*    background-color: #060;*/
    background-color: #e0f0e0;
    color: #000;
}


/*---------------------------------------------------------------------------
 *  News panel
 */

.NewsGroup {
    border-left: 1px solid #afa;
    border-top: 1px solid #afa;
    border-bottom: 1px solid white; /* IE workaround */
    margin-bottom: 8px;

    color: #060;
}

.NewsItem {
    margin: 4px;
}

.NewsDate {
    font-weight: bold;
    margin: 0px;
    padding: 0px;
}

.NewsText {
    padding: 0px;
    margin: 0px;
    margin-bottom: 8px;
}

.NewsText a { text-decoration: underline; }
.NewsText a:link { color: #060; }
.NewsText a:visited { color: #060; }
.NewsText a:active { color: red; }
.NewsText a:hover { color: red; }

.NewsMore {
    font-size: smaller;
    margin: 4px;
    margin-top: 8px;
    text-align: left;
}

.NewsGroup td {
    font-size: 12px;
}

/*---------------------------------------------------------------------------
 *  Document meta-information
 */

.Meta {
    margin-top: 64px;
    font-size: smaller;
    color: #C0C0C0;
    text-align: right;
}

.Meta a { text-decoration: underline; }
.Meta a:link { color: #C0C0C0; }
.Meta a:visited { color: #C0C0C0; }
.Meta a:active { color: red; }
.Meta a:hover { color: red; }
</style>
</html>
